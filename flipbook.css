<script type="text/javascript">
    $(document).ready(function() {
        var flipbook = $("#flipbook");

        function updateFlipbookSize() {
            var firstPage = flipbook.find('.page img').first();
            if (firstPage.length === 0) {
                console.error("No images found in the flipbook.");
                return;
            }
            var newWidth = firstPage[0].naturalWidth * 2; // Each spread spans across two pages
            var newHeight = firstPage[0].naturalHeight;

            flipbook.turn({
                width: newWidth,
                height: newHeight,
                autoCenter: true,
                display: 'double', // Ensure double display for spreads
                when: {
                    turned: function(e, page) {
                        var currentView = $(this).turn('view');
                        console.log('Current view: ', currentView);
                    }
                }
            });
        }

        var firstPage = flipbook.find('.page img').first();
        firstPage.on('load', function() {
            updateFlipbookSize();
        });

        if (firstPage.prop('complete')) {
            updateFlipbookSize();
        }

        // Event listeners for flipping pages on click
        flipbook.on('click', '.page', function() {
            flipbook.turn('next');
        });

        // Event listeners for flipping pages with arrow keys
        $(document).keydown(function(e) {
            if (e.key === "ArrowRight") {
                flipbook.turn('next');
            } else if (e.key === "ArrowLeft") {
                flipbook.turn('previous');
            }
        });
    });
</script>
